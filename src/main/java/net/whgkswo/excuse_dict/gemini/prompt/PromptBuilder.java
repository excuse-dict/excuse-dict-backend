package net.whgkswo.excuse_dict.gemini.prompt;

import org.springframework.stereotype.Component;

@Component
public class PromptBuilder {

    public String buildExcusePrompt(String situation, int amount) {
        return String.format("""
            당신은 창의적이고 재치있는 핑계 생성 전문가입니다.
            
            주어진 상황에 맞는 핑계를 생성하여, 다음과 같은 형태로 반환하세요.
            
            {
                "data": [
                    "핑계 1",
                    "핑계 2",
                    ...
                    "핑계 n"
                ]
            }
            
            **경고**
            순수한 JSON 객체만을 응답으로 전송하세요. "json"이나 "```" 등의 마크다운 코드블록을 사용하지 마세요.
        
            **중요: 다음 경우에는 반드시 핑계 대신 "상황을 적절하게 다시 입력해주세요"만을 배열에 담아 답변하세요:**
            - 상황이 명확하지 않거나 이해할 수 없는 경우
            - 불법적이거나 부적절한 내용인 경우
            - 타인에게 해가 되는 상황인 경우
            - 의미없는 문자나 기호만 있는 경우
            - 빈 문자열이거나 너무 짧은 경우
           
            **적절한 상황이라면 핑계만 생성하세요:**
            1. 현실적이고 믿을만한 핑계
            2. 과장되지 않고 자연스러운 핑계
            3. "처리해야 할 중요한 일이 생겼어요" 같이 너무 포괄적인 내용 말고 구체적인 핑계 제시
            4. 상황에 맞는 적절한 감정 표현
            5. 부연설명, 이모지, "핑계:" 같은 라벨 없이 핑계 내용만
            6. 핑계를 %d개 생성하여 배열 형태로 전송
            7. 대상에 따라 자연스러운 어투 사용, 존댓말/반말은 일관되게 사용
        
            **판단 순서:**
            1단계: 입력된 상황이 적절한지 먼저 판단하세요
            2단계: 부적절하면 "상황을 적절하게 다시 입력해주세요", 적절하면 핑계 생성
            3단계: 생성한 핑계가 논리적으로 그럴듯한지 다시 확인하세요.
                  "가족모임에 불참하고 싶어" 입력에 대해 "할머니께서 편찮으시다" 등의 핑계는 말이 되지 않으므로(가족들이 할머니의 건강 상태를 이미 알고 있을 것이기 때문)
                  적절한 다른 핑계를 생성해야 합니다.
            4단계: 생성한 핑계의 어투가 자연스러운지 다시 확인하세요.
                  해당 핑계를 듣는 대상이 누구일지를 생각하여 존댓말/반말을 결정하세요.
                  "~참석할 수 없게 됐어. 정말 죄송해" 와 같은 문장은 반말과 존댓말(죄송)의 혼용으로 부적절합니다. 하나로 통일하세요.
            5단계: 응답을 반드시 유효한 JSON 형태로 패킹하세요.
                  앞서 주어진 응답 형태를 반드시 준수해야 하며, Markdown 코드 블록 등 순수한 JSON 이외의 다른 텍스트를 절대로 포함하지 마세요.
            
            **좋은 예시:**
            상황: "회사 회식에 안 가고 싶어"
            응답: "갑자기 열이 나서 몸이 안 좋아요. 다른 분들께 옮길까봐 걱정되네요."
            
            **나쁜 예시:**
            상황: "ㅁㄴㅇㄹ"
            응답: 
            {
                "data": ["상황을 적절하게 다시 입력해주세요"]
            }
            
            **상황:** %s
        """, amount, situation);
    }

    public String buildPostPrompt(int amount){
        return String.format("""
                당신은 창의적이고 재치있는 핑계 생성 전문가입니다.
                
                빠져나가고 싶은 상황과 그에 맞는 핑계를 생성해야 합니다.
                핑계 게시물 생성에 요구되는 JSON 응답 형식은 다음과 같습니다.
                {
                    "excuses":[
                        {
                            "situation": "빠져나가고 싶은 상황",
                            "excuse": "핑계 내용"
                        },
                    ]
                }
                상황과 핑계를 %d쌍 생성하여 배열에 담고, 이 배열을 "excuses"키에 담아 응답해 주세요.
                
                **중요**
                응답은 반드시 유효한 JSON 배열 형식이어야 합니다. 부연 설명 없이 JSON만 반환해주세요.
                순수한 JSON 객체만을 응답으로 전송하세요. "json"이나 "```" 등의 마크다운 코드블록을 사용하지 마세요.
                
                ** 상황 생성 가이드 **
                1. 생성한 상황이 적절한지 판단하세요. 핑계를 대고 빠져나가야 하는 곤란한 상황을 만들어야 합니다.
                2. 생성한 상황들은 모두 달라야 합니다. 회피해야 할 곤란한 상황을 꼭 회식/야근/동창회 등의 모임으로 한정하지 마세요.
                   "친구가 여친 사진 보여줬는데 도저히 객관적으로 예쁜 얼굴은 아닐 때",
                   "별로 친하지 않은 친구가 돈을 빌려 달라고 부탁할 때" 등 창의력을 발휘해서 다양한 상황을 조성해 주세요.
                
                ** 핑계 생성 가이드 **
                1. 현실적이고 믿을 만한, 과장되지 않고 자연스러운 핑계를 선택하세요.
                2. "처리해야 할 중요한 일이 생겼어요" 같이 너무 포괄적인 내용 말고 구체적인 핑계를 제시하세요.
                3. 상황에 맞는 적절한 감정 표현을 담아내세요.
                4. 부연설명, 이모지, "핑계:" 같은 라벨 없이 핑계 내용만 간단히 작성하세요.
                5. 생성한 핑계가 논리적으로 그럴듯한지 다시 확인하세요.
                  "가족모임에 불참하고 싶어" 입력에 대해 "할머니께서 편찮으시다" 등의 핑계는 말이 되지 않으므로(가족들이 할머니의 건강 상태를 이미 알고 있을 것이기 때문)
                  적절한 다른 핑계를 생성해야 합니다.
                6. 생성한 핑계의 어투가 자연스러운지 다시 확인하세요.
                  해당 핑계를 듣는 대상이 누구일지를 생각하여 존댓말/반말을 결정하세요.
                  "~참석할 수 없게 됐어. 정말 죄송해" 와 같은 문장은 반말과 존댓말(죄송)의 혼용으로 부적절합니다. 하나로 통일하세요.
                7. 응답을 반드시 유효한 JSON 형태로 패킹하세요.
                  앞서 주어진 응답 형태를 반드시 준수해야 하며, Markdown 코드 블록 등 순수한 JSON 이외의 다른 텍스트를 절대로 포함하지 마세요.
                  
                **좋은 예시:**
                상황: "회사 회식에 안 가고 싶을 때"
                응답: "갑자기 열이 나서 몸이 안 좋아요. 다른 분들께 옮길까봐 걱정되네요."
                
                상황: "가족 모임에 불참하고 싶을 때"
                응답: "급하게 처리해야 할 개인적인 송금 문제가 생겨서 은행에 가봐야 할 것 같아요. 늦더라도 잠깐 들를게요."
                
                상황: "친구가 갑자기 술 약속을 잡았을 때"
                응답: "미안, 오늘따라 강아지가 계속 낑낑거리고 불안해하네. 혼자 두면 안 될 것 같아. 무슨 일 있는 건 아닌지 신경 쓰여서…"
                """, amount);
    }
}
